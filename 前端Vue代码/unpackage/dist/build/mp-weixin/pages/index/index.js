(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"07f6":function(t,e,a){"use strict";(function(t,e){var n=a("47a9");a("398e");n(a("3240"));var i=n(a("63ee"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(i.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"15af":function(t,e,a){"use strict";a.r(e);var n=a("b3c5"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},5606:function(t,e,a){},"63ee":function(t,e,a){"use strict";a.r(e);var n=a("dd6f"),i=a("15af");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("ef28");var c=a("828b"),r=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=r.exports},b3c5:function(t,e,a){"use strict";(function(t){var n=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("7ca3")),o=a("d3cb"),c=o.createCommonToken,r={data:function(){return{temp:"",humi:"",led:!0,buffer:!1,motor_status:!1,distance:"",light:"",token:"",timeStr:"",dateStr:"",weather:null,weatherDesc:"",city:"北京",timer:null,dataTimer:null,lastUpdate:""}},onLoad:function(){this.token=c({access_key:"7ROl6flhl+mJZ5dL7zclH8nxfXfL83sDqz/Lo/lX2ys=",version:"2022-05-01",productid:"8OCvDyLab8"}),this.startClock(),this.fetchWeather()},onShow:function(){this.fetchDevData(),this.startDataRefresh()},onHide:function(){this.stopDataRefresh()},onUnload:function(){this.timer&&clearInterval(this.timer),this.stopDataRefresh()},methods:{startDataRefresh:function(){var t=this;this.stopDataRefresh(),this.dataTimer=setInterval((function(){t.fetchDevData()}),3e3)},stopDataRefresh:function(){this.dataTimer&&(clearInterval(this.dataTimer),this.dataTimer=null)},startClock:function(){var t=this,e=function(){var e=new Date;t.timeStr=e.toLocaleTimeString("zh-CN",{hour12:!1});t.dateStr="".concat(e.getMonth()+1,"月").concat(e.getDate(),"日 ").concat(["周日","周一","周二","周三","周四","周五","周六"][e.getDay()])};e(),this.timer=setInterval(e,1e3)},fetchWeather:function(){var e=this;t.getLocation({type:"wgs84",success:function(t){console.log("定位成功:",t),e.getWeatherByLocation(t.latitude,t.longitude),e.getCityName(t.latitude,t.longitude)},fail:function(t){console.log("定位失败或权限未开启，使用默认位置(北京)",t),e.city="北京",e.getWeatherByLocation(39.9042,116.4074)}})},getCityName:function(e,a){var n=this;t.request({url:"https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(a,"&localityLanguage=zh"),success:function(t){console.log("位置信息:",t.data),t.data&&(n.city=t.data.city||t.data.locality||"本地")},fail:function(){n.city="本地"}})},getWeatherByLocation:function(e,a){var n=this;t.request({url:"https://api.open-meteo.com/v1/forecast?latitude=".concat(e,"&longitude=").concat(a,"&current_weather=true&timezone=Asia%2FShanghai"),success:function(t){t.data&&t.data.current_weather&&(n.weather=t.data.current_weather,n.weatherDesc=n.getWeatherDesc(n.weather.weathercode))},fail:function(t){console.error("天气获取失败",t)}})},getWeatherDesc:function(t){return{0:"晴",1:"晴",2:"多云",3:"阴",45:"雾",48:"雾",51:"小雨",53:"中雨",55:"大雨",61:"小雨",63:"中雨",65:"大雨",71:"小雪",73:"中雪",75:"大雪",80:"阵雨",81:"阵雨",82:"暴雨",95:"雷雨",96:"雷雨",99:"雷雨"}[t]||"未知"},fetchDevData:function(){var e=this;t.request({url:"https://iot-api.heclouds.com/thingmodel/query-device-property",method:"GET",data:{product_id:"8OCvDyLab8",device_name:"w1",_t:Date.now()},header:{authorization:this.token},success:function(t){console.log(t.data),0===t.data.code&&t.data.data&&(e.lastUpdate=(new Date).toLocaleTimeString(),t.data.data.forEach((function(t){switch(t.identifier){case"temp":e.temp=t.value;break;case"humi":e.humi=t.value;break;case"led":e.led="true"===String(t.value);break;case"buffer":e.buffer="true"===String(t.value);break;case"motor_status":e.motor_status="true"===String(t.value);break;case"distance":e.distance=t.value;break;case"light":e.light=t.value;break}})))}})},onLedSwitch:function(t){var e=t.detail.value;this.led=e,this.sendDeviceCmd("led",e)},onBufferSwitch:function(t){var e=t.detail.value;this.buffer=e,this.sendDeviceCmd("buffer",e)},onMotorSwitch:function(t){var e=t.detail.value;this.motor_status=e,this.sendDeviceCmd("motor_status",e)},sendDeviceCmd:function(e,a){t.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"8OCvDyLab8",device_name:"w1",params:(0,i.default)({},e,a)},header:{authorization:this.token},success:function(){console.log("".concat(e,": ").concat(a?"on":"off"," success!"))},fail:function(){t.showToast({title:"控制失败",icon:"none"})}})}}};e.default=r}).call(this,a("df3c")["default"])},dd6f:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},i=[]},ef28:function(t,e,a){"use strict";var n=a("5606"),i=a.n(n);i.a}},[["07f6","common/runtime","common/vendor"]]]);